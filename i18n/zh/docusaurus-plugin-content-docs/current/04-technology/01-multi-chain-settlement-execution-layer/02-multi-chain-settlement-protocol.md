# 多链结算协议

多链结算是 Rooch 的最关键特性，本章文档将详细阐述多链结算的协议以及要解决的难题。 

## 结算层承担的职责

在[模块化区块链架构](index.md)中我们明确了结算层的职责是实现 Layer1 和执行层之间的状态迁移以及资产结算。

Rooch 在每个结算层的 Layer1 中部署结算智能合约，合约中维护了一个链下状态树，链上只记录状态树的根，用户通过这颗树实现状态在 Layer1 和 Rooch 之间的迁移。具体迁移的协议参看：[状态扩容](../06-state-scaling.md)。

1. 当用户将状态从 Layer1 迁移到 Rooch 时，状态会在 Layer1 的交易最终确定后，出现在 Rooch 的状态树中。
2. 当用户将状态从 Rooch 迁移到 Layer1 时，状态会先锁定，等待挑战周期过后，再从状态树中移出，进行结算。
3. 当结算层收到仲裁层的发生欺诈的通知后，会将链下状态树的根回滚到欺诈发生之前，丢弃该期间内的状态树变更。


## 多个结算层和仲裁层之间的通讯协议

![multi chain settlement](/diagram/rooch-multi-chain-settlement.svg)

:::note

TODO 需要完善

:::

## 多链结算与跨链的区别

假如一个单链的 Layer2，通过跨链方式连接多个 Layer1，它和多链结算有什么区别？

1. 多链结算更安全。多链结算方案中的跨层桥的安全受到仲裁层的保护，执行层可以继承仲裁层的安全。
2. 更通用的跨层方案。Rooch 的多链结算方案中，跨层通过通用的状态迁移模式实现，状态可以用来代表 Token，NFT，数字合同以及其他未来的应用状态，不需要为新的状态类型设计专门的协议。